{"ast":null,"code":"import _classCallCheck from \"/Users/suchitanew/Downloads/stocks-master/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/suchitanew/Downloads/stocks-master/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/suchitanew/Downloads/stocks-master/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/suchitanew/Downloads/stocks-master/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/suchitanew/Downloads/stocks-master/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/suchitanew/Downloads/stocks-master/src/components/Table.jsx\";\nimport React from 'react';\nimport * as bulma from \"reactbulma\";\nimport StocksList from \"./StocksList.jsx\";\nimport StocksGraph from \"./StocksGraph.jsx\";\nimport Status from \"./Status.jsx\";\nimport SearchBox from \"./SearchBox.jsx\";\nvar stocksUrl = 'ws://stocks.mnet.website/';\n\nvar Table =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(Table, _React$Component);\n\n  function Table() {\n    var _this;\n\n    _classCallCheck(this, Table);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Table).call(this));\n\n    _this.componentDidMount = function () {\n      _this.connection = new WebSocket(stocksUrl);\n      _this.connection.onmessage = _this.saveNewStockValues;\n\n      _this.connection.onclose = function () {\n        _this.setState({\n          connectionError: true\n        });\n      };\n    };\n\n    _this.onSearchChange = function (event) {\n      _this.setState({\n        searchField: event.target.value\n      });\n\n      var _this$state = _this.state,\n          stocks = _this$state.stocks,\n          connectionError = _this$state.connectionError,\n          searchField = _this$state.searchField;\n      console.log(_this.state.stocks);\n      var filtered = stocks.filter(function (stock) {\n        if (searchField.length === 0) return _this.props.stocks;else return stock.stock_name.toLowerCase().includes(searchField.toLowerCase());\n      });\n      console.log(filtered);\n\n      _this.setState({\n        stocks: filtered\n      });\n    };\n\n    _this.saveNewStockValues = function (event) {\n      console.log(event.data[0][0]);\n\n      _this.props.hideSpinner();\n\n      var result = JSON.parse(event.data);\n      var current_time = Date.now();\n      var newStocks = _this.state.stocks;\n      result.map(function (stock) {\n        if (_this.state.searchField.length === 0) {\n          if (_this.state.stocks[stock[0]]) {\n            newStocks[stock[0]].current_value = Number(stock[1]);\n            newStocks[stock[0]].history.push({\n              time: current_time,\n              value: Number(stock[1])\n            });\n          } else {\n            newStocks[stock[0]] = {\n              current_value: stock[1],\n              history: [{\n                time: Date.now(),\n                value: Number(stock[1])\n              }]\n            };\n          }\n        } else if (_this.state.stocks[stock[0]].stock_name.toLowerCase().includes(_this.state.searchField.toLowerCase())) {\n          if (_this.state.stocks[stock[0]]) {\n            newStocks[stock[0]].current_value = Number(stock[1]);\n            newStocks[stock[0]].history.push({\n              time: current_time,\n              value: Number(stock[1])\n            });\n          } else {\n            newStocks[stock[0]] = {\n              current_value: stock[1],\n              history: [{\n                time: Date.now(),\n                value: Number(stock[1])\n              }]\n            };\n          }\n        }\n      });\n\n      _this.setState({\n        stocks: newStocks\n      });\n    };\n\n    _this.resetData = function () {\n      var newStocks = _this.state.stocks;\n      Object.keys(_this.state.stocks).map(function (stock_name, index) {\n        newStocks[stock_name].history = [newStocks[stock_name].history.pop()];\n      });\n\n      _this.setState({\n        stocks: newStocks\n      });\n    };\n\n    _this.loaded = function () {\n      return Object.keys(_this.state.stocks).length > 0;\n    };\n\n    _this.state = {\n      stocks: [],\n      connectionError: false,\n      searchField: ''\n    };\n    return _this;\n  }\n\n  _createClass(Table, [{\n    key: \"render\",\n    value: function render() {\n      return React.createElement(\"div\", {\n        className: \"pd3 mg3 tc\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 99\n        },\n        __self: this\n      }, React.createElement(SearchBox, {\n        searchChange: this.onSearchChange,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 102\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"columns\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 104\n        },\n        __self: this\n      }, React.createElement(StocksList, {\n        stocks: this.state.stocks,\n        resetData: this.resetData,\n        loaded: this.loaded,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 106\n        },\n        __self: this\n      }), \"}\"), React.createElement(\"div\", {\n        className: this.props.showSpinner ? 'modal is-active' : 'modal',\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 117\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"modal-background\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 118\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"modal-content\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 119\n        },\n        __self: this\n      }, React.createElement(Status, {\n        connectionError: this.state.connectionError,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 120\n        },\n        __self: this\n      }))));\n    }\n  }]);\n\n  return Table;\n}(React.Component);\n\nexport default Table;","map":{"version":3,"sources":["/Users/suchitanew/Downloads/stocks-master/src/components/Table.jsx"],"names":["React","bulma","StocksList","StocksGraph","Status","SearchBox","stocksUrl","Table","componentDidMount","connection","WebSocket","onmessage","saveNewStockValues","onclose","setState","connectionError","onSearchChange","event","searchField","target","value","state","stocks","console","log","filtered","filter","stock","length","props","stock_name","toLowerCase","includes","data","hideSpinner","result","JSON","parse","current_time","Date","now","newStocks","map","current_value","Number","history","push","time","resetData","Object","keys","index","pop","loaded","showSpinner","Component"],"mappings":";;;;;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAO,KAAKC,KAAZ,MAAuB,YAAvB;AACA,OAAOC,UAAP,MAAuB,kBAAvB;AACA,OAAOC,WAAP,MAAwB,mBAAxB;AACA,OAAOC,MAAP,MAAmB,cAAnB;AACA,OAAOC,SAAP,MAAsB,iBAAtB;AACA,IAAMC,SAAS,GAAG,2BAAlB;;IAEMC,K;;;;;AACJ,mBAAc;AAAA;;AAAA;;AACd;;AADc,UAUdC,iBAVc,GAUM,YAAM;AACxB,YAAKC,UAAL,GAAkB,IAAIC,SAAJ,CAAcJ,SAAd,CAAlB;AACA,YAAKG,UAAL,CAAgBE,SAAhB,GAA4B,MAAKC,kBAAjC;;AACA,YAAKH,UAAL,CAAgBI,OAAhB,GAA0B,YAAM;AAAE,cAAKC,QAAL,CAAc;AAACC,UAAAA,eAAe,EAAE;AAAlB,SAAd;AAAwC,OAA1E;AACD,KAda;;AAAA,UAiBdC,cAjBc,GAiBG,UAACC,KAAD,EAAW;AAE1B,YAAKH,QAAL,CAAc;AAACI,QAAAA,WAAW,EAAED,KAAK,CAACE,MAAN,CAAaC;AAA3B,OAAd;;AAF0B,wBAGmB,MAAKC,KAHxB;AAAA,UAGnBC,MAHmB,eAGnBA,MAHmB;AAAA,UAGXP,eAHW,eAGXA,eAHW;AAAA,UAGMG,WAHN,eAGMA,WAHN;AAI1BK,MAAAA,OAAO,CAACC,GAAR,CAAY,MAAKH,KAAL,CAAWC,MAAvB;AACA,UAAMG,QAAQ,GAAGH,MAAM,CAACI,MAAP,CAAc,UAAAC,KAAK,EAAE;AACpC,YAAGT,WAAW,CAACU,MAAZ,KAAqB,CAAxB,EACE,OAAO,MAAKC,KAAL,CAAWP,MAAlB,CADF,KAGE,OAAOK,KAAK,CAACG,UAAN,CAAiBC,WAAjB,GAA+BC,QAA/B,CAAwCd,WAAW,CAACa,WAAZ,EAAxC,CAAP;AACH,OALgB,CAAjB;AAMAR,MAAAA,OAAO,CAACC,GAAR,CAAYC,QAAZ;;AACA,YAAKX,QAAL,CAAc;AAAEQ,QAAAA,MAAM,EAAEG;AAAV,OAAd;AACD,KA9Ba;;AAAA,UAiCdb,kBAjCc,GAiCO,UAACK,KAAD,EAAW;AAChCM,MAAAA,OAAO,CAACC,GAAR,CAAYP,KAAK,CAACgB,IAAN,CAAW,CAAX,EAAc,CAAd,CAAZ;;AACE,YAAKJ,KAAL,CAAWK,WAAX;;AACA,UAAIC,MAAM,GAAGC,IAAI,CAACC,KAAL,CAAWpB,KAAK,CAACgB,IAAjB,CAAb;AACA,UAAIK,YAAY,GAAGC,IAAI,CAACC,GAAL,EAAnB;AACA,UAAIC,SAAS,GAAG,MAAKpB,KAAL,CAAWC,MAA3B;AACAa,MAAAA,MAAM,CAACO,GAAP,CAAW,UAACf,KAAD,EACX;AACE,YAAG,MAAKN,KAAL,CAAWH,WAAX,CAAuBU,MAAvB,KAAgC,CAAnC,EAAqC;AACnC,cAAG,MAAKP,KAAL,CAAWC,MAAX,CAAkBK,KAAK,CAAC,CAAD,CAAvB,CAAH,EACA;AAGAc,YAAAA,SAAS,CAACd,KAAK,CAAC,CAAD,CAAN,CAAT,CAAoBgB,aAApB,GAAoCC,MAAM,CAACjB,KAAK,CAAC,CAAD,CAAN,CAA1C;AACAc,YAAAA,SAAS,CAACd,KAAK,CAAC,CAAD,CAAN,CAAT,CAAoBkB,OAApB,CAA4BC,IAA5B,CAAiC;AAACC,cAAAA,IAAI,EAAET,YAAP;AAAqBlB,cAAAA,KAAK,EAAEwB,MAAM,CAACjB,KAAK,CAAC,CAAD,CAAN;AAAlC,aAAjC;AACC,WAND,MAQA;AACAc,YAAAA,SAAS,CAACd,KAAK,CAAC,CAAD,CAAN,CAAT,GAAsB;AAAEgB,cAAAA,aAAa,EAAEhB,KAAK,CAAC,CAAD,CAAtB;AAA2BkB,cAAAA,OAAO,EAAE,CAAC;AAACE,gBAAAA,IAAI,EAAER,IAAI,CAACC,GAAL,EAAP;AAAmBpB,gBAAAA,KAAK,EAAEwB,MAAM,CAACjB,KAAK,CAAC,CAAD,CAAN;AAAhC,eAAD;AAApC,aAAtB;AACC;AACF,SAZD,MAYM,IAAG,MAAKN,KAAL,CAAWC,MAAX,CAAkBK,KAAK,CAAC,CAAD,CAAvB,EAA4BG,UAA5B,CAAuCC,WAAvC,GAAqDC,QAArD,CAA8D,MAAKX,KAAL,CAAWH,WAAX,CAAuBa,WAAvB,EAA9D,CAAH,EAAuG;AAC3G,cAAG,MAAKV,KAAL,CAAWC,MAAX,CAAkBK,KAAK,CAAC,CAAD,CAAvB,CAAH,EACA;AAGAc,YAAAA,SAAS,CAACd,KAAK,CAAC,CAAD,CAAN,CAAT,CAAoBgB,aAApB,GAAoCC,MAAM,CAACjB,KAAK,CAAC,CAAD,CAAN,CAA1C;AACAc,YAAAA,SAAS,CAACd,KAAK,CAAC,CAAD,CAAN,CAAT,CAAoBkB,OAApB,CAA4BC,IAA5B,CAAiC;AAACC,cAAAA,IAAI,EAAET,YAAP;AAAqBlB,cAAAA,KAAK,EAAEwB,MAAM,CAACjB,KAAK,CAAC,CAAD,CAAN;AAAlC,aAAjC;AACC,WAND,MAQA;AACAc,YAAAA,SAAS,CAACd,KAAK,CAAC,CAAD,CAAN,CAAT,GAAsB;AAAEgB,cAAAA,aAAa,EAAEhB,KAAK,CAAC,CAAD,CAAtB;AAA2BkB,cAAAA,OAAO,EAAE,CAAC;AAACE,gBAAAA,IAAI,EAAER,IAAI,CAACC,GAAL,EAAP;AAAmBpB,gBAAAA,KAAK,EAAEwB,MAAM,CAACjB,KAAK,CAAC,CAAD,CAAN;AAAhC,eAAD;AAApC,aAAtB;AACC;AACF;AAEF,OA5BD;;AA6BA,YAAKb,QAAL,CAAc;AAACQ,QAAAA,MAAM,EAAEmB;AAAT,OAAd;AACD,KArEa;;AAAA,UAuEdO,SAvEc,GAuEF,YAAM;AAChB,UAAIP,SAAS,GAAG,MAAKpB,KAAL,CAAWC,MAA3B;AACA2B,MAAAA,MAAM,CAACC,IAAP,CAAY,MAAK7B,KAAL,CAAWC,MAAvB,EAA+BoB,GAA/B,CAAmC,UAACZ,UAAD,EAAaqB,KAAb,EACnC;AACEV,QAAAA,SAAS,CAACX,UAAD,CAAT,CAAsBe,OAAtB,GAAgC,CAACJ,SAAS,CAACX,UAAD,CAAT,CAAsBe,OAAtB,CAA8BO,GAA9B,EAAD,CAAhC;AACD,OAHD;;AAIA,YAAKtC,QAAL,CAAc;AAAEQ,QAAAA,MAAM,EAAEmB;AAAV,OAAd;AACD,KA9Ea;;AAAA,UAgFdY,MAhFc,GAgFL,YAAM;AACb,aAAOJ,MAAM,CAACC,IAAP,CAAY,MAAK7B,KAAL,CAAWC,MAAvB,EAA+BM,MAA/B,GAAwC,CAA/C;AACD,KAlFa;;AAEd,UAAKP,KAAL,GAAa;AACZC,MAAAA,MAAM,EAAE,EADI;AAEZP,MAAAA,eAAe,EAAE,KAFL;AAGZG,MAAAA,WAAW,EAAE;AAHD,KAAb;AAFc;AAOb;;;;6BA6EQ;AAGP,aAEE;AAAK,QAAA,SAAS,EAAC,YAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAGE,oBAAC,SAAD;AAAW,QAAA,YAAY,EAAE,KAAKF,cAA9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAHF,EAKE;AAAK,QAAA,SAAS,EAAC,SAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAEA,oBAAC,UAAD;AACI,QAAA,MAAM,EAAE,KAAKK,KAAL,CAAWC,MADvB;AAEI,QAAA,SAAS,EAAE,KAAK0B,SAFpB;AAGI,QAAA,MAAM,EAAE,KAAKK,MAHjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFA,MALF,EAkBE;AAAK,QAAA,SAAS,EAAG,KAAKxB,KAAL,CAAWyB,WAAX,GAAyB,iBAAzB,GAA6C,OAA9D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE;AAAK,QAAA,SAAS,EAAC,kBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,EAEE;AAAK,QAAA,SAAS,EAAC,eAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE,oBAAC,MAAD;AAAQ,QAAA,eAAe,EAAE,KAAKjC,KAAL,CAAWN,eAApC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,CAFF,CAlBF,CAFF;AA4BD;;;;EApHiBf,KAAK,CAACuD,S;;AAuH1B,eAAehD,KAAf","sourcesContent":["import React from 'react'\nimport * as bulma from \"reactbulma\";\nimport StocksList from \"./StocksList.jsx\";\nimport StocksGraph from \"./StocksGraph.jsx\";\nimport Status from \"./Status.jsx\";\nimport SearchBox from \"./SearchBox.jsx\";\nconst stocksUrl = 'ws://stocks.mnet.website/';\n\nclass Table extends React.Component {\n  constructor (){\n  super()\n  this.state = {\n   stocks: [],\n   connectionError: false,\n   searchField: ''\n  }\n  }\n  \n\n  componentDidMount = () => {\n    this.connection = new WebSocket(stocksUrl);\n    this.connection.onmessage = this.saveNewStockValues;\n    this.connection.onclose = () => { this.setState({connectionError: true}) }\n  }\n\n\n  onSearchChange = (event) => { \n    \n    this.setState({searchField: event.target.value})\n    const {stocks, connectionError, searchField}=this.state;\n    console.log(this.state.stocks);     \n    const filtered = stocks.filter(stock=>{  \n      if(searchField.length===0)\n        return this.props.stocks\n      else\n        return stock.stock_name.toLowerCase().includes(searchField.toLowerCase())     \n    }) \n    console.log(filtered);\n    this.setState({ stocks: filtered });   \n  }\n\n\n  saveNewStockValues = (event) => {\n  console.log(event.data[0][0])\n    this.props.hideSpinner();\n    let result = JSON.parse(event.data);\n    let current_time = Date.now();\n    let newStocks = this.state.stocks\n    result.map((stock) =>\n    {\n      if(this.state.searchField.length===0){\n        if(this.state.stocks[stock[0]] )\n        {\n        \n\n        newStocks[stock[0]].current_value = Number(stock[1])\n        newStocks[stock[0]].history.push({time: current_time, value: Number(stock[1])})\n        }\n        else\n        {\n        newStocks[stock[0]] = { current_value: stock[1], history: [{time: Date.now(), value: Number(stock[1])}] }\n        }\n      }else if(this.state.stocks[stock[0]].stock_name.toLowerCase().includes(this.state.searchField.toLowerCase())){\n        if(this.state.stocks[stock[0]])\n        {\n        \n\n        newStocks[stock[0]].current_value = Number(stock[1])\n        newStocks[stock[0]].history.push({time: current_time, value: Number(stock[1])})\n        }\n        else\n        {\n        newStocks[stock[0]] = { current_value: stock[1], history: [{time: Date.now(), value: Number(stock[1])}] }\n        }\n      }\n      \n    });\n    this.setState({stocks: newStocks})\n  }\n\n  resetData = () => {\n    let newStocks = this.state.stocks;\n    Object.keys(this.state.stocks).map((stock_name, index) =>\n    {\n      newStocks[stock_name].history = [newStocks[stock_name].history.pop()];\n    });\n    this.setState({ stocks: newStocks });\n  }\n\n  loaded = () => {\n    return Object.keys(this.state.stocks).length > 0;\n  }\n\n  render() {\n     \n    \n    return (\n\n      <div className='pd3 mg3 tc'>\n        \n\n        <SearchBox searchChange={this.onSearchChange}/>\n        \n        <div className='columns'>\n        \n        <StocksList\n            stocks={this.state.stocks}\n            resetData={this.resetData}\n            loaded={this.loaded}\n          />\n         \n          }\n          \n          \n        </div>\n       \n        <div className={ this.props.showSpinner ? 'modal is-active' : 'modal' }>\n          <div className=\"modal-background\"></div>\n          <div className=\"modal-content\">\n            <Status connectionError={this.state.connectionError} />\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default Table;\n"]},"metadata":{},"sourceType":"module"}